name: CI/CD Pipeline

on:
  push:
    branches: [main]
  schedule:
    # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00 UTC (06:00 –ø–æ –ú–æ—Å–∫–≤–µ)
    - cron: '0 3 * * *'
  workflow_dispatch:  # –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  python-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      - name: Install dependencies
        run: pip install pytest pytest-mock requests-mock freezegun
      - name: Run Python tests
        run: pytest tests/ -v

  api-tests:
    needs: python-tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Newman
        run: npm install -g newman
      - name: Run Postman tests (GET only)
        run: |
          echo "üöÄ Running API tests..."
          newman run "collections/Namaz Bot API Tests.postman_collection.json" \
            --folder "Get data"
        continue-on-error: true

  success:
    needs: [python-tests, api-tests]
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: CI/CD Status
        run: |
          echo "üéâ CI/CD Pipeline completed!"
          echo "‚úÖ Python tests: ${{ needs.python-tests.result }}"
          echo "ÔøΩÔøΩ API tests: ${{ needs.api-tests.result }}"
          echo "üïí Time: $(date)"
          echo ""
          echo "Next: configure SSH key for auto-deploy"
